<div class="flex min-h-screen bg-indigo-50">
  <app-side-bar></app-side-bar>

  <main class="container mx-auto px-4 py-8">
    <h1 class="text-4xl font-bold text-indigo-700 mb-8">Gestión Multimedia</h1>

    <!-- Video Upload Section -->
    <section class="mb-16">
      <h2 class="text-3xl font-bold text-indigo-700 mb-6">Subir Video</h2>
      <form [formGroup]="videoForm" (ngSubmit)="onSubmitVideo()" class="bg-white p-6 rounded-xl shadow-lg">
        <div class="mb-6">
          <label class="block text-indigo-700 font-semibold mb-3">Título del Video</label>
          <input type="text" formControlName="title" placeholder="Título del video"
                 class="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-indigo-400 focus:border-transparent">
          <div class="text-red-600 text-sm mt-1" *ngIf="videoForm.get('title')?.invalid && videoForm.get('title')?.touched">
            <span *ngIf="videoForm.get('title')?.errors?.['required']">Campo requerido</span>
            <span *ngIf="videoForm.get('title')?.errors?.['minlength']">Mínimo 3 caracteres</span>
          </div>
        </div>

        <div class="mb-6">
          <label class="block text-indigo-700 font-semibold mb-3">Descripción</label>
          <textarea formControlName="description" rows="4" placeholder="Descripción del video"
                    class="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-indigo-400 focus:border-transparent"></textarea>
          <div class="text-red-600 text-sm mt-1" *ngIf="videoForm.get('description')?.invalid && videoForm.get('description')?.touched">
            <span *ngIf="videoForm.get('description')?.errors?.['required']">Campo requerido</span>
            <span *ngIf="videoForm.get('description')?.errors?.['minlength']">Mínimo 10 caracteres</span>
          </div>
        </div>

        <div class="mb-6">
          <label class="block text-indigo-700 font-semibold mb-3">Archivo de Video (MP4/WebM, máx. 50MB)</label>
          <input type="file" accept="video/mp4,video/webm" (change)="onVideoFileChange($event)"
                 class="w-full file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
          <video #videoPreview *ngIf="currentVideoFile" controls class="mt-4 w-full max-w-2xl rounded-lg"></video>
        </div>

        <div class="mb-6">
          <label class="block text-indigo-700 font-semibold mb-3">Subtítulos en Español (.vtt/.srt)</label>
          <input type="file" accept=".vtt,.srt" (change)="onSubtitleESChange($event)"
                 class="w-full file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
        </div>

        <div class="mb-8">
          <label class="block text-indigo-700 font-semibold mb-3">Subtítulos en Inglés (.vtt/.srt)</label>
          <input type="file" accept=".vtt,.srt" (change)="onSubtitleENChange($event)"
                 class="w-full file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
        </div>

        <!-- Video Player -->
        <div *ngIf="currentVideoFile && (subtitleENUrl || subtitleESUrl)" class="mb-8">
          <div class="flex gap-3 mb-4">
            <button type="button" (click)="changeSubtitleLanguage('es')" 
                    [class.bg-indigo-600]="selectedSubtitle === 'es'"
                    class="px-4 py-2 rounded-lg text-white transition-colors"
                    [class.bg-gray-400]="selectedSubtitle !== 'es'">
              Español
            </button>
            <button type="button" (click)="changeSubtitleLanguage('en')"
                    [class.bg-indigo-600]="selectedSubtitle === 'en'"
                    class="px-4 py-2 rounded-lg text-white transition-colors"
                    [class.bg-gray-400]="selectedSubtitle !== 'en'">
              English
            </button>
          </div>
          <video #videoPlayer controls class="w-full max-w-2xl rounded-lg bg-black"></video>
        </div>

        <div *ngIf="videoError" class="mb-6 p-4 bg-red-100 text-red-700 rounded-lg">
          {{ videoError }}
        </div>

        <button type="submit" [disabled]="videoForm.invalid"
                class="w-full py-3 px-6 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg transition-colors disabled:bg-indigo-300 disabled:cursor-not-allowed">
          Subir Video
        </button>
      </form>
    </section>

    <!-- Image Upload Section -->
    <section class="mb-16">
      <h2 class="text-3xl font-bold text-indigo-700 mb-6">Subir Imagen</h2>
      <form [formGroup]="imageForm" (ngSubmit)="onSubmitImage()" class="bg-white p-6 rounded-xl shadow-lg">
        <div class="mb-6">
          <label class="block text-indigo-700 font-semibold mb-3">Imagen (JPG/PNG/WebP, mín. 800x600px)</label>
          <input type="file" accept="image/jpeg,image/png,image/webp" (change)="onImageFileChange($event)"
                 class="w-full file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
        </div>

        <div *ngIf="imageError" class="mb-6 p-4 bg-red-100 text-red-700 rounded-lg">
          {{ imageError }}
        </div>

        <div *ngIf="isImageLoaded" class="mb-8">
          <h3 class="text-xl font-bold text-indigo-600 mb-4">Editor de Imagen</h3>
          
          <div class="cropper-container mx-auto mb-8">
            <img #imageElement [src]="imagePreview" alt="Previsualización" class="cropper-image">
          </div>

          <div class="flex flex-wrap gap-3 justify-center mb-6">
            <button type="button" (click)="rotateImage(-90)" class="toolbar-btn">
              <i class="fas fa-undo-alt mr-2"></i>Rotar Izquierda
            </button>
            <button type="button" (click)="rotateImage(90)" class="toolbar-btn">
              <i class="fas fa-redo-alt mr-2"></i>Rotar Derecha
            </button>
            <button type="button" (click)="zoomIn()" class="toolbar-btn">
              <i class="fas fa-search-plus mr-2"></i>Zoom In
            </button>
            <button type="button" (click)="zoomOut()" class="toolbar-btn">
              <i class="fas fa-search-minus mr-2"></i>Zoom Out
            </button>
            <button type="button" (click)="setMoveMode()" class="toolbar-btn">
              <i class="fas fa-arrows-alt mr-2"></i>Mover
            </button>
            <button type="button" (click)="setZoomMode()" class="toolbar-btn">
              <i class="fas fa-crop-alt mr-2"></i>Recortar
            </button>
            <button type="button" (click)="resetCropper()" class="toolbar-btn">
              <i class="fas fa-sync-alt mr-2"></i>Reiniciar
            </button>
            <button type="button" (click)="onCropImage()" class="toolbar-btn bg-green-600 hover:bg-green-700">
              <i class="fas fa-check mr-2"></i>Aplicar Recorte
            </button>
          </div>

          <div *ngIf="croppedImage" class="preview-container mx-auto">
            <h3 class="text-xl font-bold text-indigo-600 mb-4">Vista Previa</h3>
            <img [src]="croppedImage" alt="Imagen Recortada" class="preview-image">
          </div>
        </div>

        <button type="submit" [disabled]="!croppedImage"
                class="w-full py-3 px-6 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg transition-colors disabled:bg-indigo-300 disabled:cursor-not-allowed">
          Guardar Imagen
        </button>
      </form>
    </section>
  </main>
</div>